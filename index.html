<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic Tac Toe</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- Font Awsome icons -->
    <link rel="stylesheet" href="css/all.min.css" />
</head>
<body>
    <header>
        <h1><span>X</span>O Game</h1>
    </header>
    <div class="player" id="player">
        <p>Current player is user : <span id="current-player"></span> </p>
    </div>
    <div class="square">
        <div class="column1">
            <div onclick="drawShape(this)" id="spot1"></div>
            <div onclick="drawShape(this)" id="spot2"></div>
            <div onclick="drawShape(this)" id="spot3"></div>
        </div>
        <div class="column2">
            <div onclick="drawShape(this)" id="spot4"></div>
            <div onclick="drawShape(this)" id="spot5"></div>
            <div onclick="drawShape(this)" id="spot6"></div>
        </div>
        <div class="column3">
            <div onclick="drawShape(this)" id="spot7"></div>
            <div onclick="drawShape(this)" id="spot8"></div>
            <div onclick="drawShape(this)" id="spot9"></div>
        </div>
    </div>
    <div class="show-winner" id="show-winner" style="display: none;">
        <div class="text">
            <h1>The Winner</h1>
            <h2>User <span id="winner"></span></h2>
        </div>
        <div class="win-counter">
            <p>Score:</p>
            <p id="counter-win-1">User 1 : </p>
            <p id="counter-win-2">User 2 : </p>
        </div>
        <button onclick="repeat()"><i class="fa-solid fa-repeat"></i> Repeat</button>
    </div>
    <div class="show-no-winner" id="show-no-winner" style="display: none;">
        <div class="text">
            <h1>No Winner</h1>
        </div>
        <div class="win-counter">
            <p>Score:</p>
            <p id="counter-nowin-1">User 1 : </p>
            <p id="counter-nowin-2">User 2 : </p>
        </div>
        <button onclick="repeat()"><i class="fa-solid fa-repeat"></i> Repeat</button>
    </div>
    <footer>
        <p>Copyright &copy; 2026, made by <span>Yassine Ait Mansour.</span></p>
    </footer>
    
    <script>
        var board = ["", "", "", "", "", "", "", "", ""];
        const winningPossbilities = [
            [0, 1, 2],
            [3, 4, 5],
            [6, 7, 8],
            [0, 3, 6],
            [1, 4, 7],
            [2, 5, 8],
            [0, 4, 8],
            [2, 4, 6]
        ]
        var winnerCount1 = Number(JSON.parse(sessionStorage.getItem("1")));
        var winnerCount2 = Number(JSON.parse(sessionStorage.getItem("2")));
        var user = JSON.parse(sessionStorage.getItem("startuser"));
        displayCurrentUser(user);
        if (user === null) {
            user = "1";
            displayCurrentUser(user);
        }
        function drawShape(element, spots) {
            let spotId = element.id;
            if (user == "1") {
                let spotBoardIndex = Number(spotId.slice(-1)) - 1;
                if (board[spotBoardIndex].length == 0) {
                    board[spotBoardIndex] = "x";
                    drawX(spotId);
                } else {
                    return;
                }
                let isThereWinner = checkWinner(user);
                if (isThereWinner == true) {
                    return;
                }
                if (is_saturated()) {
                    showNoWin();
                }
                user = "2";
                displayCurrentUser(user);
            } else if (user == "2") {
                let spotBoardIndex = Number(spotId.slice(-1)) - 1;
                if (board[spotBoardIndex].length == 0) {
                    board[spotBoardIndex] = "o";
                    drawO(spotId);
                } else {
                    return;
                }
                let isThereWinner = checkWinner(user);
                if (isThereWinner == true) {
                    return;
                }
                if (is_saturated()) {
                    showNoWin();
                }
                user = "1";
                displayCurrentUser(user);
            }
        }
        function drawX(spotId) {
            document.getElementById(spotId).style.backgroundImage = "url(assets/X.png)";
            document.getElementById(spotId).style.backgroundSize = "cover";
        }
        function drawO(spotId) {
            document.getElementById(spotId).style.backgroundImage = "url(assets/O.png)";
            document.getElementById(spotId).style.backgroundSize = "cover";
        }
        function checkWinner(user) {
            let shape;
            if (user == "1") {
                shape = "x";
            } else {
                shape = "o";
            }
            for (let possibility of winningPossbilities) {
                if (board[possibility[0]] == shape && board[possibility[1]] == shape && board[possibility[2]] == shape) {
                    trackWin(user);
                    showWinner(user);
                    return true;
                }
            }
            return false;
        }
        function is_saturated() {
            return board.every((spot) => spot.length !== 0);
        }
        function showWinner(user) {
            document.getElementById("winner").innerHTML += user;
            document.getElementById("show-winner").style.display = "flex";
            hideCurrentPlayer();
            displayCountWin();
            if (user == "1") {
                sessionStorage.setItem("startuser", "2");
            } else {
                sessionStorage.setItem("startuser", "1");
            }
        }
        function showNoWin() {
            document.getElementById("show-no-winner").style.display = "flex";
            hideCurrentPlayer();
            displayCountNoWin();
            if (user == "1") {
                sessionStorage.setItem("startuser", "2");
            } else {
                sessionStorage.setItem("startuser", "1");
            }
        }
        function repeat() {
            window.location.reload(true);
        }
        function trackWin(user) {
            sessionStorage.removeItem(user);
            if (user == "1") {
                sessionStorage.setItem(user, String(winnerCount1 + 1));
                winnerCount1 = Number(JSON.parse(sessionStorage.getItem("1")));
            } else {
                sessionStorage.setItem(user, String(winnerCount2 + 1));
                winnerCount2 = Number(JSON.parse(sessionStorage.getItem("2")));
            }
        }
        function displayCurrentUser(user) {
            if (user == "1") {
                document.getElementById("current-player").innerHTML = user;
                document.getElementById("current-player").style.color = "rgb(255, 189, 30)";
            } else {
                document.getElementById("current-player").innerHTML = user;
                document.getElementById("current-player").style.color = "rgba(41, 133, 254, 0.926)";
            }
        }
        function displayCountWin() {
            document.getElementById("counter-win-1").innerHTML += winnerCount1;
            document.getElementById("counter-win-2").innerHTML += winnerCount2;
        }
        function displayCountNoWin() {
            document.getElementById("counter-nowin-1").innerHTML += winnerCount1;
            document.getElementById("counter-nowin-2").innerHTML += winnerCount2;
        }
        function hideCurrentPlayer() {
            document.getElementById("player").style.display = "none";
        }
    </script>
</body>
</html>